{% extends 'navbar/navbar.html' %}
{% block title %}Index{% endblock %}
{% block head %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'produtos/visualizar.css' %}" />
    <title>Visualização de Produtos</title>
</head>
<body>
        <!-- <form class="form-visualizacao-produto">
            {% csrf_token %}
            {% if sucesso_cadastro %}
            <div class="success-cadastro-message" id = "success-cadastro-message">
                    {{ sucesso_cadastro }}
            </div> 
            {% endif %}
            <br>
            <div class="filtro">
              <br>
              <input class = "busca" type="text" name="pesquisa" id="pesquisa" placeholder="Digite o nome ou código de barras do produto">
              <button class="btn btn-light" type="submit">Buscar</button>
            </div>
            <br>
            {% for produto in produtos %}
            <div>
              <br>
              <label class="campo" for="nome">Nome:</label>
              {{ produto.nome }}
            </div>
            <div>
              <label class="campo" for="cpf">Código de Barras:</label>
              {{ produto.codigo_barras }}
            </div>
            <div>
              <label class="campo" for="login">Preço:</label>
              <span class="preco" data-preco="{{ produto.preco }}">{{ produto.preco }}</span>
            </div>
            <a href="{% url  'acessar_produto' produto.id %}" class="botao_acessar"> Acessar para edição </a>
          {% endfor %}
          </form> -->

          <form class="form-visualizacao-produto">
            {% csrf_token %}
            {% if sucesso_cadastro %}
            <div class="success-cadastro-message" id = "success-cadastro-message">
                    {{ sucesso_cadastro }}
            </div> 
            {% endif %}
            <h2 class="titulo"><strong>Lista de Produtos</strong></h2>
            <div class="filtro">
              <input class = "busca" type="text" name="pesquisa" id="pesquisa" placeholder="Digite o nome ou código de barras do produto">
              <button class="btn btn-light" type="submit">Buscar</button>  
            </div>
            <table class="table table-hover lista">
              <thead>
                <tr>
                  <th class="nome" scope="col">Nome</th> 
                  <th class="codbarras" scope="col">Código de Barras</th>
                  <th class="inpreco" scope="col">Preço</th>
                  <th class="exc" scope="col"></th>
                </tr>
              </thead>
              <tbody>
                {% for produto in produtos %} 
                <tr>
                  <td>{{ produto.nome }}</td> 
                  <td>{{ produto.codigo_barras }}</td>
                  <td>R$ {{ produto.preco }}</td>
                  <td class="coluna">
                    <a href="{% url 'acessar_produto' produto.id %}" class="btn btn-primary btn-sm botao-edit">Editar</a>
                  </td>          
                </tr>    
                {% endfor %}
              </tbody>
            </table>
          </form>

          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>

          <script>
            const precos = document.getElementsByClassName("preco");
            for (let i = 0; i < precos.length; i++) {
                const precoElement = precos[i];
                const preco = precoElement.getAttribute("data-preco");
                const precoFormatado = parseFloat(preco).toLocaleString("pt-BR", {
                    style: "currency",
                    currency: "BRL",
                });
                precoElement.textContent = precoFormatado;
                }
              $(document).ready(function() {
                $('#cpf').inputmask('999.999.999-99');
              });
              function hideSuccessMessage(message) {
                  var successMessage = document.getElementById("success-cadastro-message");
                  successMessage.innerText = message;
                  successMessage.style.display = "block";
          
                  setTimeout(function() {
                      successMessage.style.display = "none";
                  }, 4000);
              }
              var successMessage = document.getElementById("success-cadastro-message");
              if (successMessage) {
                  var message = successMessage.innerText;
                  hideSuccessMessage(message);
              }
        </script>        
    {% endblock %}
</body>
</html>
